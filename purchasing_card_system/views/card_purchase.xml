<odoo>
    <data>
    <record id="apply_penalty" model="ir.cron">
       <field name="name">Apply Penalty</field>
       <field name="model_id" ref="purchasing_card_system.model_card_purchase_installment"/>
       <field name="state">code</field>
       <field name="code">model.apply_penalty()</field>
       <field name="user_id" ref="base.user_root"/>
       <field name='interval_number'>1</field>
       <field name='interval_type'>days</field>
       <field name="numbercall">-1</field>
       <field name="doall" eval="False"/>
   </record>
    <record id="card_purchase_tree" model="ir.ui.view">
        <field name="name">card.purchase.tree</field>
        <field name="model">card.purchase</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name" />  
                <field name="customer_id" /> 
                <field name="total_installments_amount"/> 
                <field name="contract_id" />  
                <field name="installment_type" />                
                <field name="start_date" />                
                <field name = 'state'/>                
                <field name = 'applied_penalty_amount'/>                

            </tree>
        </field>
    </record>
    <record id="card_purchase_installment_penalty_form" model="ir.ui.view">
        <field name="name">card.purchase.installment.penalty.form</field>
        <field name="model">card.purchase.installment</field>
        <field name="arch" type="xml">
            <form string="Security Worker">
                <sheet>
                    <notebook >
                        <page name="penalty" string="Penalties">
                            <field name = 'penalty_applied_ids' readonly = '1'>
                                <tree editable = 'bottom'>
                                    <field name = 'date'/>
                                    <field name = 'amount'/>
                                    <field name = 'actual_amount'/>

                                    <button name = 'wave_penalty' string = 'Wave Penalty'  type = 'object'/>

                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <record id="card_purchase_form" model="ir.ui.view">
        <field name="name">card.purchase.form</field>
        <field name="model">card.purchase</field>
        <field name="arch" type="xml">
            <form string="Security Worker">
                <header>
                    <field name = 'admin_fees_invoice_created' invisible = '1'/>
                    <field name = 'invoice_created' invisible = '1'/>
                    <field name = 'is_discount_created' invisible = '1'/>

                    <button name = 'running' string = 'Run' type = 'object' states = 'draft'/>
                    <button name = 'create_bill' string = 'Create Bill' type = 'object' attrs="{'invisible': ['|',('count_bill', '!=', 0),('state','!=','running')]}"/>
                    <button name = 'create_invoice' string = 'Create Invoice' type = 'object' attrs="{'invisible': ['|',('invoice_created', '=',True),('state','!=','running')]}"/>
                    <button name = 'create_admin_fees_invoice' string = 'Create Admin Fees Invoice' type = 'object' attrs="{'invisible': ['|',('admin_fees_invoice_created', '=',True),('state','!=','running')]}"/>
                    <button name = 'apply_discount' string = 'Apply Discount' type = 'object' attrs="{'invisible': ['|',('is_discount_created', '=', True),('state','!=','running')]}"/>
                    <field name = 'state' widget = 'statusbar'/>
                </header>
                <sheet>
                     <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object" icon="fa-book" name="show_bill"  attrs="{'invisible': [('count_bill', '=', 0)]}">
                            <field name="count_bill" widget="statinfo" string="Bills"/>
                        </button>
                       <button class="oe_stat_button" type="object" icon="fa-book" name="show_invoice"  attrs="{'invisible': [('count_invoice', '=', 0)]}">
                            <field name="count_invoice" widget="statinfo"  string="Invoices"/>
                        </button>
                       <button class="oe_stat_button" type="object" icon="fa-book" name="show_inverse"  attrs="{'invisible': [('count_inverse', '=', 0)]}">
                            <field name="count_inverse" widget="statinfo"  string="Inverse Entries"/>
                        </button>
                       <button class="oe_stat_button" type="object" icon="fa-book" name="show_payment"  attrs="{'invisible': [('count_payment', '=', 0)]}">
                            <field name="count_payment" widget="statinfo"  string="Payment Entries"/>
                        </button>
                    </div>
                    <group>
                            <group>
                                <field name="name" readonly = '1'/>  
                                <field name="customer_id" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="vendor_id" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="vendor_branch" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="contract_id" attrs = "{'readonly':[('state','!=','draft')]}"/>  
                                <field name="installment_type" attrs = "{'readonly':[('state','!=','draft')]}"/>                
                                <field name="start_date" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="buying_date" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="end_date" /> 
                                <field name="installment_product_id" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="intrest_product_id" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="admin_fees_product_id" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="penalty_product_id" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="journal_id" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                        </group>
                             <group>                
                                <field name="total_installments_amount" attrs = "{'readonly':[('state','!=','draft')]}"/>    
                                <field name="down_payment" attrs = "{'readonly':[('state','!=','draft')]}"/>
                                <field name="actual_purchase_amount" attrs = "{'readonly':[('state','!=','draft')]}"/>    
                                <field name="number_of_installments" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="commission_rate" widget = 'percentage'/>
                                <field name="benefit_rate" widget = 'percentage'/>  
                                <field name="benefit_rate_amount" />  
                                <field name="installment_amount" />                 
                                <field name="penalty_amount" attrs = "{'readonly':[('state','!=','draft')]}"/> 
                                <field name="admin_fees_amount" attrs = "{'readonly':[('state','!=','draft')]}"/>
                                 <field name="amount_due" />
                                 <field name="discount_rate" widget = 'percentage'  attrs = "{'readonly':[('is_discount_created', '=', True)]}"/>
                            </group>
                    </group>
                    <notebook >
                        <page name="installment" string="Installments" attrs = "{'invisible' : [('state','=','draft')]}">
                            <field name = 'installment_ids' readonly = '1'>
                                <tree editable = 'bottom'>
                                    <field name = 'due_date'/>
                                    <field name = 'amount' string = 'Principle Amount'/>
                                    <field name = 'benefit_rate_amount'/>
                                    <field name = 'discount' widget = 'percentage'/>
                                    <field name = 'actual_benefit_rate_amount'/>
                                    <field name = 'actual_fees'/>
                                    <field name = 'penalty_amount'/>
                                    <field name = 'actual_penalty_amount'/>
                                    <field name = 'actual_amount'/>
                                    <field name = 'payment_reference'/>
                                    <field name = 'paid_amount'/>
                                    <field name = 'due_amount'/>
                                    <field name = 'payment_status'/>
                                    <button name = 'pay' string = 'Pay' attrs = "{'invisible' : [('payment_status','=','paid')]}" type = 'object'/>

                                    <button name = 'show_penalty' string = 'Show Penalty' attrs = "{'invisible' : ['|',('payment_status','=','paid'),('penalty_amount','=',0)]}" type = 'object'/>
                                </tree>
                            </field>
                        </page>
                        <page name="items" string="Items">
                            <field name = 'item_ids'>
                                <tree editable = 'bottom'>
                                    <field name = 'product_id'/>
                                    <field name = 'category_id'/>
                                    <field name = 'internal_category_id'/>
                                    <field name = 'price'/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <record id="card_purchase_menu_action" model="ir.actions.act_window">
        <field name="name">Card purchase</field>
        <field name="res_model">card.purchase</field>
        <field name="view_mode">tree,form</field>
        <field
            name="view_ids"
            eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('card_purchase_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('card_purchase_form')})]"
        />
    </record>
    <record id="show_penalty_action" model="ir.actions.act_window">
        <field name="name">Card purchase penalty</field>
        <field name="res_model">card.purchase.installment</field>
        <field name="view_mode">form</field>
        <field name = 'target'>new</field>
        <field
            name="view_ids"
            eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'form', 'view_id': ref('card_purchase_installment_penalty_form')})]"
        />
    </record>
        

    </data>
</odoo>